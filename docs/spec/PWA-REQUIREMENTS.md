# PWA Requirements for Android TWA

**Last Updated:** 2025-12-26  
**Status:** Audit Complete - See findings below

---

## PWA Requirements Checklist

### 1. Web App Manifest

#### ‚úÖ **PASS: Manifest Exists**
- **Location:** `app/dist/manifest.webmanifest` (generated on build)
- **Status:** Generated by `vite-plugin-pwa` during build process

#### ‚úÖ **PASS: Required Fields Present**
- **name:** `"FishingInsights"` ‚úÖ
- **short_name:** `"FishingInsights"` ‚úÖ
- **start_url:** `"/"` ‚úÖ
- **display:** `"standalone"` ‚úÖ (required for TWA)
- **theme_color:** `"#0ea5e9"` ‚úÖ
- **background_color:** `"#ffffff"` ‚úÖ

#### ‚úÖ **PASS: Manifest Linked in HTML**
- **Location:** `app/dist/index.html`
- **Link tag:** `<link rel="manifest" href="/manifest.webmanifest">` ‚úÖ

#### ‚úÖ **PASS: Icons Present**
- **Required:** 192x192 icon (`pwa-192x192.png`) ‚úÖ
- **Required:** 512x512 icon (`pwa-512x512.png`) ‚úÖ
- **Status:** Icons exist in `app/public/` and are copied to `dist/` on build
- **Impact:** App can install properly, TWA icon requirements met

#### ‚úÖ **PASS: Maskable Icon Present**
- **Required for TWA:** At least one maskable icon (512x512 recommended)
- **Status:** Maskable icon defined (`pwa-512x512-maskable.png` with `purpose: "maskable"`)
- **Impact:** Android TWA will display icon correctly on home screen

---

### 2. Service Worker

#### ‚úÖ **PASS: Service Worker Generated**
- **Location:** `app/dist/sw.js` (generated on build)
- **Status:** Generated by `vite-plugin-pwa` with Workbox

#### ‚úÖ **PASS: Service Worker Registered**
- **Registration Script:** `app/dist/registerSW.js` (auto-generated)
- **HTML Integration:** `<script id="vite-plugin-pwa:register-sw" src="/registerSW.js"></script>` in built `index.html`
- **Registration Type:** `autoUpdate` (configured in `vite.config.ts`)

#### ‚úÖ **PASS: Runtime Caching Configured**
- **API Caching:** NetworkFirst strategy for `/api/*` routes
- **Cache Name:** `api-cache`
- **Network Timeout:** 3 seconds
- **Status:** Configured in `vite.config.ts` workbox options

---

### 3. Offline Behavior

#### ‚úÖ **PASS: App Shell Cached**
- **Strategy:** Precaching via Workbox
- **Files Cached:** All JS, CSS, HTML, and static assets
- **Status:** Configured via `globPatterns: ["**/*.{js,css,html,ico,png,svg}"]`

#### ‚úÖ **PASS: Offline Error Handling**
- **Location:** `app/src/pages/Forecast.tsx`
- **Current Behavior:** 
  - Detects offline state using `navigator.onLine` and online/offline event listeners
  - Shows friendly "You're offline" banner when offline
  - Displays "Showing last saved forecast" when cached data is available
  - Provides Retry button when connection is restored
- **Impact:** Good UX when offline - clear messaging and cached data support

#### ‚ö†Ô∏è **PARTIAL: API Response Caching**
- **Strategy:** NetworkFirst with 3-second timeout
- **Behavior:** Falls back to cache if network fails
- **Status:** Configured but not tested
- **Note:** Cache may be empty on first offline visit

---

### 4. HTTPS Requirements

#### ‚ö†Ô∏è **REQUIRED FOR PRODUCTION: HTTPS Mandatory**
- **Service Workers:** Require HTTPS (or localhost for development)
- **Android TWA:** Requires HTTPS for production deployment
- **PWA Installation:** Requires HTTPS (except localhost)
- **Current Status:** Development uses HTTP (localhost:3000) - acceptable for dev
- **Production Requirement:** Must deploy with HTTPS certificate

**Production Deployment Checklist:**
- ‚úÖ SSL/TLS certificate installed
- ‚úÖ All API endpoints accessible via HTTPS
- ‚úÖ No mixed content (HTTP resources on HTTPS page)
- ‚úÖ Valid certificate (not self-signed for production)

---

## Must-Fix Items Before Android TWA Build

### üî¥ **CRITICAL (Blocks TWA)**

1. **Create PWA Icons**
   - Create `app/public/pwa-192x192.png` (192x192 pixels)
   - Create `app/public/pwa-512x512.png` (512x512 pixels)
   - Icons must be valid PNG files
   - Icons should represent the app (fishing/weather theme)

2. **Add Maskable Icon**
   - Create `app/public/pwa-512x512-maskable.png` (512x512 pixels)
   - OR add `purpose: "maskable"` to existing 512x512 icon in manifest
   - Maskable icons have safe zone (inner 80% of icon) for Android adaptive icons

3. **Implement Offline Error Handling**
   - Detect network failures in `app/src/pages/Forecast.tsx`
   - Show friendly "You're offline" message instead of generic error
   - Consider showing cached forecast data if available

4. **HTTPS in Production**
   - Deploy with valid SSL certificate
   - Ensure all API endpoints accessible via HTTPS
   - Test service worker registration on HTTPS

### üü° **RECOMMENDED (Improves UX)**

1. **Add Offline Indicator**
   - Show visual indicator when offline
   - Update UI when connection restored

2. **Cache First Load**
   - Ensure app shell loads from cache when offline
   - Test offline loading of main pages

3. **Add App Icons to HTML**
   - Add `<link rel="icon">` tags for various sizes
   - Add Apple touch icon for iOS compatibility

4. **Test Service Worker Activation**
   - Verify service worker activates in production build
   - Test cache behavior in browser DevTools

---

## Optional Enhancements

1. **Background Sync** (for future)
   - Queue API requests when offline
   - Sync when connection restored

2. **Push Notifications** (for future)
   - Notify users of forecast updates
   - Requires user permission

3. **Install Prompt** (for future)
   - Custom install prompt UI
   - Better install experience

---

## Testing Commands

### Build and Verify
```bash
cd app
npm run build
```

### Check Generated Files
```bash
# Verify manifest exists
ls app/dist/manifest.webmanifest

# Verify service worker exists
ls app/dist/sw.js

# Verify registration script exists
ls app/dist/registerSW.js
```

### Test Offline (Browser DevTools)
1. Open Chrome DevTools (F12)
2. Go to Application tab
3. Service Workers section: Verify service worker is registered and active
4. Manifest section: Verify manifest loads correctly
5. Network tab: Enable "Offline" checkbox
6. Reload page: Verify app shell loads
7. Navigate to forecast page: Verify offline message appears

### Test HTTPS (Production)
```bash
# After deploying with HTTPS
curl -I https://yourdomain.com/manifest.webmanifest
curl -I https://yourdomain.com/sw.js
```

---

## Current Status Summary

| Requirement | Status | Notes |
|-------------|--------|-------|
| Manifest exists | ‚úÖ PASS | Generated on build |
| Required manifest fields | ‚úÖ PASS | All present |
| Manifest linked in HTML | ‚úÖ PASS | Auto-injected |
| Icons (192, 512) | ‚úÖ PASS | Files created and included in dist/ |
| Maskable icon | ‚úÖ PASS | Defined with purpose: "maskable" |
| Service worker generated | ‚úÖ PASS | Generated on build |
| Service worker registered | ‚úÖ PASS | Auto-registered |
| App shell cached | ‚úÖ PASS | Precaching configured (12 entries) |
| Offline error handling | ‚úÖ PASS | Friendly offline messages + cached data + retry |
| HTTPS in production | ‚ö†Ô∏è REQUIRED | Must deploy with HTTPS |

---

## Next Steps

1. ‚úÖ **Icon files created** (`pwa-192x192.png`, `pwa-512x512.png`, `pwa-512x512-maskable.png`)
2. ‚úÖ **Maskable icon added** to manifest
3. ‚úÖ **Offline detection implemented** in Forecast page
4. **Test offline behavior** in browser DevTools (see Testing Commands below)
5. **Deploy with HTTPS** for production testing
6. **Verify TWA requirements** using Android TWA validator

---

## References

- [Android TWA Requirements](https://developer.chrome.com/docs/android/trusted-web-activity/)
- [PWA Checklist](https://web.dev/pwa-checklist/)
- [Maskable Icons](https://web.dev/maskable-icon/)
- [Service Worker API](https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API)

